<div class="container">
  <form [formGroup]="recipeForm" (ngSubmit)="onSubmit()">
    <div class="recipe_form__container">
      <div class="recipe_inputs__container">
        <mat-form-field appearance="fill">
          <mat-label>Name</mat-label>
          <input matInput formControlName="name" required />
        </mat-form-field>

        <input type="file" (change)="onFileSelected($event)" />

        <mat-form-field appearance="fill">
          <mat-label>Short Description</mat-label>
          <textarea
            matInput
            formControlName="shortDescription"
            required
          ></textarea>
        </mat-form-field>

        <div class="form-group">
          <label for="description">Description:</label>
          <editor
            apiKey="c8qwc5cv96qiwizuswzet80gvul391n2juf3v14t1vs4rcem"
            id="description"
            formControlName="description"
            required
          ></editor>
        </div>

        <div class="form-group">
          <label for="cookingInstructions">Cooking Instructions:</label>
          <editor
            apiKey="c8qwc5cv96qiwizuswzet80gvul391n2juf3v14t1vs4rcem"
            id="cookingInstructions"
            formControlName="cookingInstructions"
            required
          ></editor>
        </div>

        <button mat-raised-button color="primary" type="submit">
          Add Recipe
        </button>
      </div>
      <div>
        <mat-form-field appearance="fill">
          <mat-label>Categories</mat-label>
          <mat-select formArrayName="categories" multiple>
            <mat-option
              *ngFor="let category of categories; let i = index"
              [value]="category.id"
              (click)="onCategorySelectionChange(category)"
            >
              {{ category.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <div
          *ngIf="selectedCategories.length > 0"
          class="selected_category__container"
        >
          <div
            *ngFor="let category of selectedCategories; let i = index"
            class="selected_category"
          >
            {{ category.name }}
            <button mat-icon-button (click)="removeCategory(i)">
              <mat-icon>close</mat-icon>
            </button>
          </div>
        </div>
      </div>
      <div class="recipe_ingredients__container">
        <button mat-raised-button type="button" (click)="addIngredientField()">
          Add Ingredient
        </button>

        <div
          formArrayName="selectedIngredients"
          class="recipe_selected_ingredients__container"
        >
          <div
            *ngFor="let ingredientField of selectedIngredients; let i = index"
            [formGroupName]="i"
            class="ingredient-field"
          >
            <mat-form-field appearance="fill">
              <mat-label>Ingredients</mat-label>
              <mat-select
                (selectionChange)="onIngredientSelected($event, i)"
                formControlName="selectedIngredient"
              >
                <mat-option
                  *ngFor="let ingredient of ingredients"
                  [value]="ingredient.id"
                >
                  {{ ingredient.name }}
                </mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Quantity</mat-label>
              <input
                matInput
                type="number"
                formControlName="selectedIngredientQuantity"
                placeholder="Quantity"
              />
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Unit</mat-label>
              <input
                matInput
                type="text"
                formControlName="selectedIngredientUnit"
                required
              />
            </mat-form-field>

            <button
              mat-raised-button
              type="button"
              color="warn"
              (click)="removeIngredientField(i)"
            >
              Remove
            </button>
          </div>
        </div>
      </div>
    </div>
  </form>
</div>
